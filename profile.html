<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>Anigemlist</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    :root { 
      --nav-h: 70px;
      --primary-color: #b57cff;
      --primary-hover: #a366ff;
      --primary-soft: rgba(181, 124, 255, 0.15);
      --dark-bg: #0a0a0c;
      --card-bg: #141418;
      --border-color: #2c2c34;
      --text-light: #fff;
      --text-dim: #b0b0b8;
      --input-bg: #1e1e24;
      
      --fs-xs: clamp(0.7rem, 2vw, 0.8rem);
      --fs-sm: clamp(0.8rem, 2.2vw, 0.9rem);
      --fs-md: clamp(0.9rem, 2.5vw, 1rem);
      --fs-lg: clamp(1.1rem, 3vw, 1.3rem);
      --fs-xl: clamp(1.3rem, 4vw, 1.8rem);
      --fs-xxl: clamp(1.5rem, 5vw, 2.2rem);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: var(--dark-bg);
      color: var(--text-light);
      padding-top: var(--nav-h);
      overflow-x: hidden;
      width: 100%;
    }

    /* ===== NAVBAR (TETAP) ===== */
    nav {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 0 5%;
      background: #0c0c10;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      height: var(--nav-h);
    }

    nav h2 {
      font-weight: 700;
      font-size: var(--fs-lg);
      color: white;
      white-space: nowrap;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: clamp(20px, 4vw, 40px);
      margin: 0;
      padding: 0;
    }

    nav ul li {
      cursor: pointer;
      font-weight: 500;
      color: var(--text-dim);
      transition: all 0.3s ease;
      font-size: var(--fs-sm);
      padding: 6px 0;
      position: relative;
      white-space: nowrap;
    }

    nav ul li a {
      color: inherit;
      text-decoration: none;
    }

    nav ul li.active {
      color: var(--primary-color);
    }

    nav ul li.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--primary-color);
      border-radius: 3px;
    }

    nav ul li:hover {
      color: var(--primary-color);
    }

    .hamburger {
      display: none;
      flex-direction: column;
      cursor: pointer;
      gap: 5px;
    }

    .hamburger span {
      width: 25px;
      height: 3px;
      background: white;
      border-radius: 3px;
      transition: 0.3s;
    }

    .hamburger.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    .hamburger.active span:nth-child(2) { opacity: 0; }
    .hamburger.active span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -7px);
    }

    /* ===== PROFILE CARD ===== */
    .container {
      max-width: 100%;
      width: 95%;
      margin: 0 auto;
      padding: clamp(15px, 3vw, 30px) clamp(15px, 4vw, 30px);
    }

    /* Desktop lebar */
    @media (min-width: 1400px) { .container { max-width: 1600px; width: 92%; } }
    @media (min-width: 1200px) and (max-width: 1399px) { .container { max-width: 1400px; width: 92%; } }
    @media (min-width: 992px) and (max-width: 1199px) { .container { max-width: 1200px; width: 94%; } }

    /* Profile Header - sekarang sebagai card column */
    .profile-header {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: clamp(20px, 4vw, 30px) clamp(25px, 5vw, 40px);
      margin-bottom: clamp(20px, 3vw, 30px);
      display: flex;
      flex-direction: column;
      gap: clamp(20px, 3vw, 30px);
    }

    /* Baris 1 : Avatar + Profile Info */
    .profile-row1 {
      display: flex;
      align-items: center;
      gap: clamp(15px, 4vw, 30px);
      flex-wrap: nowrap;      /* tidak boleh turun */
    }

    .avatar {
      width: clamp(70px, 12vw, 100px);
      height: clamp(70px, 12vw, 100px);
      background: var(--primary-soft);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 3px solid var(--primary-color);
      flex-shrink: 0;
    }

    .avatar i {
      font-size: clamp(32px, 6vw, 48px);
      color: var(--primary-color);
    }

    .profile-info {
      flex: 1;
      min-width: 0;           /* biar bisa menyusut */
    }

    .profile-info h1 {
      font-size: var(--fs-xxl);
      font-weight: 700;
      margin-bottom: 5px;
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .profile-info .username {
      color: var(--primary-color);
      font-size: var(--fs-md);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ===== BADGE - BASE STYLE ===== */
    .profile-badges {
      display: flex;
      gap: clamp(10px, 2vw, 20px);
      flex-wrap: wrap;
      width: 100%;
    }

    .badge-item {
      background: var(--input-bg);
      padding: clamp(8px, 1.5vw, 12px) clamp(12px, 2vw, 24px);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: clamp(6px, 1.2vw, 12px);
      transition: all 0.3s ease;
      cursor: pointer;
      flex: 0 1 auto;        /* desktop: tidak stretch */
    }

    .badge-item:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
    }

    .badge-item:hover i,
    .badge-item:hover .badge-info h4,
    .badge-item:hover .badge-info span {
      color: white;
    }

    .badge-item i {
      color: var(--primary-color);
      font-size: clamp(18px, 3.5vw, 24px);
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .badge-info {
      min-width: 0;
      flex: 1;
    }

    .badge-info h4 {
      font-size: var(--fs-xs);
      color: var(--text-dim);
      margin-bottom: 2px;
      white-space: nowrap;
      transition: all 0.3s ease;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .badge-info span {
      font-size: clamp(18px, 3.5vw, 24px);
      font-weight: 700;
      color: white;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    /* ===== STATS CONTROL ===== */
    .stats-controls {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: clamp(20px, 3vw, 25px) clamp(20px, 4vw, 30px);
      margin-bottom: clamp(20px, 3vw, 30px);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: clamp(16px, 3vw, 24px);
      align-items: end;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .control-group label {
      display: block;
      color: var(--text-dim);
      font-size: var(--fs-xs);
      font-weight: 600;
      margin-bottom: 8px;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .control-group label i {
      color: var(--primary-color);
      margin-right: 6px;
      font-size: var(--fs-sm);
    }

    .category-buttons {
      display: flex;
      gap: 10px;
      width: 100%;
    }

    .category-btn {
      border: 1px solid white;
      background: #0a0a0c;
      color: white;
      font-weight: 600;
      padding: clamp(8px, 1.5vw, 12px) clamp(8px, 2vw, 20px);
      border-radius: 12px;
      font-size: var(--fs-sm);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1 1 0;
      justify-content: center;
      white-space: nowrap;
    }

    .category-btn i { font-size: var(--fs-md); }
    .category-btn.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    .category-btn:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    /* ===== DROPDOWN ===== */
    .custom-dropdown {
      width: 100%;
    }
    .custom-dropdown .btn {
      width: 100%;
      background: #0a0a0c;
      border: 1px solid #3a3a44;
      border-radius: 12px;
      padding: clamp(8px, 1.5vw, 12px) clamp(12px, 2vw, 20px);
      color: white;
      font-size: var(--fs-sm);
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: all 0.2s ease;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .custom-dropdown .btn span {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .custom-dropdown .btn:hover,
    .custom-dropdown .btn:focus {
      background: #15151c;
      border-color: var(--primary-color);
      box-shadow: none;
    }
    .custom-dropdown .btn::after {
      content: "\f078";
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
      border: none;
      margin-left: 8px;
      color: var(--primary-color);
      font-size: var(--fs-xs);
      flex-shrink: 0;
    }
    .custom-dropdown .dropdown-menu {
      width: 100%;
      min-width: 100%;
      background: #0c0c14;
      border: 1px solid #3a3a44;
      border-radius: 16px;
      padding: 8px;
      margin-top: 6px;
      box-shadow: 0 20px 30px rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      max-height: 300px;
      overflow-y: auto;
    }
    .custom-dropdown .dropdown-item {
      color: white;
      border-radius: 10px;
      padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 18px);
      font-size: var(--fs-sm);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.15s;
      white-space: normal;
      word-break: break-word;
    }
    .custom-dropdown .dropdown-item i {
      width: 20px;
      color: var(--primary-color);
      flex-shrink: 0;
    }
    .custom-dropdown .dropdown-item:hover {
      background: var(--primary-color);
      color: white;
    }
    .custom-dropdown .dropdown-item:hover i { color: white; }
    .custom-dropdown .dropdown-item.active {
      background: rgba(181,124,255,0.2);
      color: var(--primary-color);
      font-weight: 600;
    }

    /* ===== CHART ===== */
    .chart-container {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: clamp(16px, 3vw, 25px);
      margin-bottom: clamp(20px, 3vw, 30px);
      box-shadow: 0 16px 32px rgba(0,0,0,0.4);
    }
    .chart-wrapper {
      position: relative;
      height: clamp(250px, 50vw, 350px);
      width: 100%;
    }
    canvas { max-width: 100%; height: auto !important; }

    /* ===== CONCLUSION ===== */
    .conclusion-card {
      background: linear-gradient(145deg, rgba(181,124,255,0.08), rgba(20,20,28,0.9));
      border: 1px solid rgba(181,124,255,0.5);
      border-radius: 14px;
      padding: clamp(18px, 3vw, 25px) clamp(20px, 4vw, 35px);
      margin-top: 20px;
      backdrop-filter: blur(8px);
    }
    .conclusion-card i {
      color: var(--primary-color);
      font-size: clamp(24px, 5vw, 28px);
      margin-right: 15px;
      flex-shrink: 0;
    }
    .conclusion-text {
      font-size: var(--fs-md);
      line-height: 1.6;
      color: white;
      font-weight: 500;
      word-break: break-word;
    }
    .conclusion-text span {
      color: var(--primary-color);
      font-weight: 700;
    }

    /* ============================================ */
    /* ===== RESPONSIVE BADGE - FULL WIDTH ===== */
    /* ============================================ */

    /* Tablet (768px - 991px) */
    @media (min-width: 768px) and (max-width: 991px) {
      .profile-badges {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
      .badge-item {
        width: 100%;          /* maksimalkan lebar */
        padding: 12px 16px;
      }
      .badge-item:nth-child(1),
      .badge-item:nth-child(2) {
        grid-column: span 1;
      }
      .badge-item:nth-child(3) {
        grid-column: span 2;
        justify-content: center;
      }
      /* Navbar tetap horizontal */
      .hamburger { display: none; }
    }

    /* Mobile (576px - 767px) */
    @media (min-width: 576px) and (max-width: 767px) {
      .container { padding: 15px; }
      
      /* Hamburger aktif */
      .hamburger { display: flex; }
      nav ul {
        position: fixed;
        top: var(--nav-h);
        left: 0;
        width: 100%;
        background: #0c0c10;
        flex-direction: column;
        align-items: center;
        padding: 30px 0;
        gap: 25px;
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: 0.4s;
        border-top: 1px solid rgba(255,255,255,0.1);
      }
      nav ul.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }

      .profile-badges {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .badge-item {
        width: 100%;
        padding: 10px 12px;
      }
      .badge-item:nth-child(1),
      .badge-item:nth-child(2) {
        grid-column: span 1;
      }
      .badge-item:nth-child(3) {
        grid-column: span 2;
        justify-content: center;
      }
      .badge-item i { font-size: 20px; }
      .badge-info h4 { font-size: 12px; }
      .badge-info span { font-size: 20px; }

      /* Stats controls 1 kolom */
      .stats-controls {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 20px;
      }
    }

    /* Mobile kecil (375px - 575px) */
    @media (min-width: 375px) and (max-width: 575px) {
      .container { padding: 12px; }
      nav h2 { font-size: 20px; }
      .hamburger { display: flex; }
      nav ul {
        position: fixed;
        top: var(--nav-h);
        left: 0;
        width: 100%;
        background: #0c0c10;
        flex-direction: column;
        align-items: center;
        padding: 25px 0;
        gap: 20px;
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: 0.4s;
      }
      nav ul.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }

      .profile-row1 {
        gap: 12px;
      }
      .avatar {
        width: 52px;
        height: 52px;
      }
      .avatar i { font-size: 28px; }
      .profile-info h1 { font-size: 20px; }
      .profile-info .username { font-size: 12px; }

      .profile-badges {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .badge-item {
        width: 100%;
        padding: 8px 10px;
      }
      .badge-item:nth-child(1),
      .badge-item:nth-child(2) {
        grid-column: span 1;
      }
      .badge-item:nth-child(3) {
        grid-column: span 2;
        justify-content: center;
      }
      .badge-item i { font-size: 18px; }
      .badge-info h4 { font-size: 11px; }
      .badge-info span { font-size: 18px; }

      .stats-controls {
        grid-template-columns: 1fr;
        padding: 18px;
      }
      .category-btn { padding: 8px 6px; font-size: 13px; }
    }

    /* Mobile ekstrem (<375px) */
    @media (max-width: 374px) {
      .container { padding: 10px; }
      nav h2 { font-size: 18px; }
      .hamburger { display: flex; }
      nav ul {
        position: fixed;
        top: var(--nav-h);
        left: 0;
        width: 100%;
        background: #0c0c10;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
        gap: 18px;
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: 0.4s;
      }
      nav ul.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }

      .profile-row1 {
        gap: 10px;
      }
      .avatar {
        width: 48px;
        height: 48px;
      }
      .avatar i { font-size: 26px; }
      .profile-info h1 { font-size: 18px; }
      .profile-info .username { font-size: 11px; }

      .profile-badges {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
      }
      .badge-item {
        width: 100%;
        padding: 6px 8px;
      }
      .badge-item:nth-child(1),
      .badge-item:nth-child(2) {
        grid-column: span 1;
      }
      .badge-item:nth-child(3) {
        grid-column: span 2;
        justify-content: center;
      }
      .badge-item i { font-size: 16px; }
      .badge-info h4 { font-size: 10px; }
      .badge-info span { font-size: 16px; }

      .stats-controls {
        grid-template-columns: 1fr;
        padding: 15px;
      }
      .category-btn { padding: 8px 4px; font-size: 12px; }
    }

    /* Landscape & sentuhan */
    @media (max-height: 500px) and (orientation: landscape) {
      nav { height: 60px; }
      :root { --nav-h: 60px; }
      .profile-header { padding: 15px 20px; }
      .avatar { width: 50px; height: 50px; }
      .badge-item { padding: 6px 12px; }
      .chart-wrapper { height: 180px; }
    }
    @media (hover: none) and (pointer: coarse) {
      .category-btn, .custom-dropdown .btn, .dropdown-item { min-height: 44px; }
      nav ul li { padding: 12px 0; }
      .badge-item { min-height: 60px; }
    }
  </style>
</head>
<body>

<!-- NAVBAR -->
<nav>
  <h2>Anigemlist</h2>
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <ul id="navMenu">
    <li><a href="index.html">Home</a></li>
    <li><a href="list.html">List</a></li>
    <li><a href="review.html">Add Review</a></li>
    <li class="active"><a href="profile.html">Profile</a></li>
  </ul>
</nav>

<!-- MAIN PROFILE -->
<div class="container">

  <!-- PROFILE CARD -->
  <div class="profile-header">
    <!-- BARIS 1: Avatar + Username (dan member since) -->
    <div class="profile-row1">
      <div class="avatar">
        <i class="fas fa-user-circle"></i>
      </div>
      <div class="profile-info">
        <h1>Srvnt07</h1>
        <div class="username">
          <i class="fas fa-calendar-alt"></i> Member since 2023
        </div>
      </div>
    </div>

    <!-- BARIS 2 & 3: Semua Badge (diatur via CSS) -->
    <div class="profile-badges">
      <div class="badge-item">
        <i class="fas fa-gamepad"></i>
        <div class="badge-info">
          <h4>Games Played</h4>
          <span id="totalGames">115</span>
        </div>
      </div>
      <div class="badge-item">
        <i class="fas fa-film"></i>
        <div class="badge-info">
          <h4>Anime Watched</h4>
          <span id="totalAnime">78</span>
        </div>
      </div>
      <div class="badge-item">
        <i class="fas fa-star"></i>
        <div class="badge-info">
          <h4>Total Reviews</h4>
          <span>85</span>
        </div>
      </div>
    </div>
  </div>

  <!-- STATS CONTROLS -->
  <div class="stats-controls">
    <div class="control-group">
      <label><i class="fas fa-tag"></i> TYPE</label>
      <div class="category-buttons">
        <button id="btnGame" class="category-btn active"><i class="fas fa-gamepad"></i> Game</button>
        <button id="btnAnime" class="category-btn"><i class="fas fa-film"></i> Anime</button>
      </div>
    </div>
    <div class="control-group">
      <label><i class="fas fa-chart-bar"></i> CHART</label>
      <div class="custom-dropdown dropdown">
        <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="chartTypeDropdownBtn">
          <span><i class="fas fa-chart-bar me-2" style="color: #b57cff;"></i> Bar Chart</span>
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item active" data-value="bar" href="#"><i class="fas fa-chart-bar"></i> Bar Chart</a></li>
          <li><a class="dropdown-item" data-value="line" href="#"><i class="fas fa-chart-line"></i> Line Chart</a></li>
          <li><a class="dropdown-item" data-value="pie" href="#"><i class="fas fa-chart-pie"></i> Pie Chart</a></li>
        </ul>
      </div>
    </div>
    <div class="control-group">
      <label><i class="fas fa-filter"></i> KRITERIA</label>
      <div class="custom-dropdown dropdown">
        <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="criteriaDropdownBtn">
          <span><i class="fas fa-filter me-2" style="color: #b57cff;"></i> Platform</span>
        </button>
        <ul class="dropdown-menu" id="criteriaDropdownMenu"></ul>
      </div>
    </div>
  </div>

  <!-- CHART -->
  <div class="chart-container">
    <div class="chart-wrapper">
      <canvas id="statsChart"></canvas>
    </div>
  </div>

  <!-- CONCLUSION -->
  <div class="conclusion-card">
    <div class="d-flex align-items-center">
      <i class="fas fa-quote-left"></i>
      <div class="conclusion-text" id="conclusionText">Loading statistic...</div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // ---------- HAMBURGER ----------
  const hamburger = document.getElementById('hamburger');
  const navMenu = document.getElementById('navMenu');
  hamburger.addEventListener('click', (e) => {
    e.stopPropagation();
    hamburger.classList.toggle('active');
    navMenu.classList.toggle('active');
  });
  document.addEventListener('click', (e) => {
    if (!navMenu.contains(e.target) && !hamburger.contains(e.target)) {
      hamburger.classList.remove('active');
      navMenu.classList.remove('active');
    }
  });

  // ---------- DATA ----------
  const gameStats = {
    platform: { labels: ['PC', 'PlayStation', 'Xbox', 'Nintendo', 'Mobile'], values: [42, 35, 18, 28, 22] },
    genre: { labels: ['Action', 'RPG', 'FPS', 'Adventure', 'Simulation'], values: [48, 39, 22, 19, 12] },
    year: { labels: ['2024', '2023', '2022', '2021', '2020'], values: [15, 32, 28, 23, 17] },
    developer: { labels: ['FromSoftware', 'Naughty Dog', 'CD Projekt', 'Rockstar', 'Nintendo'], values: [24, 21, 17, 14, 19] }
  };
  const animeStats = {
    type: { labels: ['TV Series', 'Movie', 'OVA', 'ONA'], values: [52, 24, 10, 6] },
    genre: { labels: ['Action', 'Fantasy', 'Romance', 'Slice of Life', 'Comedy'], values: [42, 35, 22, 18, 26] },
    year: { labels: ['2024', '2023', '2022', '2021', '2020'], values: [18, 32, 28, 24, 20] },
    studio: { labels: ['Ufotable', 'Kyoto Animation', 'Madhouse', 'Bones', 'MAPPA'], values: [18, 15, 12, 16, 22] }
  };
  const colorPalette = ['#FF6B6B','#4ECDC4','#FFE66D','#FF9F1C','#C77DFF','#AACC00','#00B4D8','#FF8C42','#9381FF','#06D6A0','#E5989B','#6D597A','#B56576','#F08A5D','#6A4C93','#1982C4','#8AC926','#FFCA3A'];
  function getColors(count) { let c=[]; for(let i=0;i<count;i++) c.push(colorPalette[i%colorPalette.length]); return c; }

  let currentCategory = 'game';
  let myChart;

  function populateCriteriaDropdown(category) {
    const menu = document.getElementById('criteriaDropdownMenu');
    menu.innerHTML = '';
    let items = category === 'game' 
      ? [ { value:'platform', text:'Platform', icon:'fa-solid fa-computer' },
          { value:'genre', text:'Genre', icon:'fa-solid fa-masks-theater' },
          { value:'year', text:'Year', icon:'fa-regular fa-calendar' },
          { value:'developer', text:'Developer', icon:'fa-solid fa-building' } ]
      : [ { value:'type', text:'Type', icon:'fa-solid fa-tv' },
          { value:'genre', text:'Genre', icon:'fa-solid fa-masks-theater' },
          { value:'year', text:'Year', icon:'fa-regular fa-calendar' },
          { value:'studio', text:'Studio', icon:'fa-solid fa-film' } ];
    items.forEach((item,i) => {
      let li = document.createElement('li');
      let a = document.createElement('a');
      a.className = `dropdown-item ${i===0?'active':''}`;
      a.href = '#'; a.setAttribute('data-value', item.value);
      a.innerHTML = `<i class="${item.icon} me-2"></i> ${item.text}`;
      li.appendChild(a); menu.appendChild(li);
    });
    document.getElementById('criteriaDropdownBtn').innerHTML = `<span><i class="${items[0].icon} me-2" style="color: #b57cff;"></i> ${items[0].text}</span>`;
  }

  function getCurrentData() {
    let active = document.querySelector('#criteriaDropdownMenu .dropdown-item.active');
    let crit = active ? active.getAttribute('data-value') : 'platform';
    return currentCategory==='game' ? (gameStats[crit]||gameStats.platform) : (animeStats[crit]||animeStats.type);
  }

  function updateChart() {
    let activeChart = document.querySelector('.custom-dropdown .dropdown-item.active[data-value]');
    let type = activeChart ? activeChart.getAttribute('data-value') : 'bar';
    let data = getCurrentData();
    if (!data) return;
    if (myChart) myChart.destroy();
    let ds = {
      label: currentCategory==='game' ? 'Jumlah Game Dimainkan' : 'Jumlah Anime Ditonton',
      data: data.values, borderWidth: 2, borderRadius: 6, tension: 0.3
    };
    if (type === 'bar') {
      ds.backgroundColor = getColors(data.labels.length);
      ds.borderColor = ds.backgroundColor.map(c=>c);
      ds.borderWidth = 1;
    } else if (type === 'pie') {
      ds.backgroundColor = getColors(data.labels.length);
      ds.borderColor = 'white'; ds.borderWidth = 2;
    } else {
      ds.backgroundColor = 'rgba(78,205,196,0.1)';
      ds.borderColor = '#4ECDC4'; ds.borderWidth = 3;
      ds.pointBackgroundColor = '#4ECDC4'; ds.pointBorderColor = 'white';
    }
    myChart = new Chart(document.getElementById('statsChart'), {
      type: type,
      data: { labels: data.labels, datasets: [ds] },
      options: {
        responsive: true, maintainAspectRatio: false,
        plugins: {
          legend: { display: type==='pie', position:'bottom', labels:{color:'white'} },
          tooltip: { backgroundColor:'#1e1e24', titleColor:'white', bodyColor:'#b0b0b8' }
        },
        scales: type==='pie' ? {} : {
          y: { beginAtZero: true, grid: { color:'#2c2c34' }, ticks: { color:'#b0b0b8' } },
          x: { grid: { display: false }, ticks: { color:'#b0b0b8' } }
        }
      }
    });
    let act = document.querySelector('#criteriaDropdownMenu .dropdown-item.active');
    let crit = act ? act.getAttribute('data-value') : 'platform';
    updateConclusion(crit, data);
  }

  function updateConclusion(criteria, data) {
    let total = data.values.reduce((a,b)=>a+b,0);
    let maxIdx = data.values.indexOf(Math.max(...data.values));
    let top = data.labels[maxIdx], val = data.values[maxIdx], perc = ((val/total)*100).toFixed(1);
    let text = '';
    if (currentCategory === 'game') {
      if (criteria === 'platform') text = `üéÆ <span>Srvnt07</span> paling sering bermain di platform <span>${top}</span> (${val} judul, ${perc}% dari total game).`;
      else if (criteria === 'genre') text = `üé≠ Genre <span>${top}</span> mendominasi koleksi game (${val} judul, ${perc}%).`;
      else if (criteria === 'year') text = `üìÜ Tahun <span>${top}</span> adalah tahun paling produktif, dengan ${val} game diselesaikan.`;
      else if (criteria === 'developer') text = `üè¢ Developer favorit: <span>${top}</span>! ${val} game dari mereka telah dimainkan.`;
      else text = `üìä Preferensi game mengarah ke <span>${top}</span>.`;
    } else {
      if (criteria === 'type') text = `üì∫ Tipe <span>${top}</span> paling banyak ditonton (${val} judul, ${perc}% dari total anime).`;
      else if (criteria === 'genre') text = `üé≠ Genre anime favorit: <span>${top}</span> dengan ${val} judul (${perc}%).`;
      else if (criteria === 'year') text = `üìÜ Tahun <span>${top}</span> adalah tahun terbanyak menonton anime (${val} judul).`;
      else if (criteria === 'studio') text = `üè¢ Studio <span>${top}</span> paling sering dinikmati, sebanyak ${val} anime.`;
      else text = `üìä Preferensi anime mengarah ke <span>${top}</span>.`;
    }
    document.getElementById('conclusionText').innerHTML = text;
  }

  function setCategory(cat) {
    currentCategory = cat;
    let g = document.getElementById('btnGame'), a = document.getElementById('btnAnime');
    if (cat==='game') { g.classList.add('active'); a.classList.remove('active'); }
    else { a.classList.add('active'); g.classList.remove('active'); }
    populateCriteriaDropdown(cat);
    updateChart();
  }

  // event listeners
  document.querySelectorAll('#chartTypeDropdownBtn + .dropdown-menu .dropdown-item').forEach(el => {
    el.addEventListener('click', function(e) {
      e.preventDefault();
      document.querySelectorAll('#chartTypeDropdownBtn + .dropdown-menu .dropdown-item').forEach(x=>x.classList.remove('active'));
      this.classList.add('active');
      document.getElementById('chartTypeDropdownBtn').innerHTML = `<span><i class="${this.querySelector('i').className} me-2" style="color: #b57cff;"></i> ${this.textContent.trim()}</span>`;
      updateChart();
    });
  });
  document.getElementById('criteriaDropdownMenu').addEventListener('click', function(e) {
    let item = e.target.closest('.dropdown-item');
    if (!item) return;
    e.preventDefault();
    document.querySelectorAll('#criteriaDropdownMenu .dropdown-item').forEach(x=>x.classList.remove('active'));
    item.classList.add('active');
    document.getElementById('criteriaDropdownBtn').innerHTML = `<span><i class="${item.querySelector('i').className} me-2" style="color: #b57cff;"></i> ${item.textContent.trim()}</span>`;
    updateChart();
  });
  document.getElementById('btnGame').addEventListener('click', ()=>setCategory('game'));
  document.getElementById('btnAnime').addEventListener('click', ()=>setCategory('anime'));

  window.onload = function() {
    setCategory('game');
    let bar = document.querySelector('#chartTypeDropdownBtn + .dropdown-menu .dropdown-item[data-value="bar"]');
    if (bar) {
      bar.classList.add('active');
      document.getElementById('chartTypeDropdownBtn').innerHTML = `<span><i class="fas fa-chart-bar me-2" style="color: #b57cff;"></i> Bar Chart</span>`;
    }
    document.getElementById('totalGames').innerText = gameStats.platform.values.reduce((a,b)=>a+b,0);
    document.getElementById('totalAnime').innerText = animeStats.type.values.reduce((a,b)=>a+b,0);
  };
</script>

</body>
</html>